<?php namespace Ip\Internal; abstract class ValueStorage extends RawStorage { public function get($key, $defaultValue = null) { $value = ipDb()->selectValue( $this->tableName, array($this->valueColumn), array($this->namespaceColumn => $this->namespace, $this->keyColumn => $key) ); return ($value === null) ? $defaultValue : json_decode($value, true); } public function set($key, $value) { parent::set($key, json_encode($value)); } public function getAll() { $values = ipDb()->selectAll( $this->tableName, array($this->keyColumn, $this->valueColumn), array($this->namespaceColumn => $this->namespace) ); $result = []; foreach ($values as $value) { $result[$value[$this->keyColumn]] = json_decode($value[$this->valueColumn], true); } return $result; } } ?>